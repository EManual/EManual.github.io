1>EJB声明式事务(也叫容器管理事务)
由EJB容器来负责管理事务,EJB的Bean类不需要直接编写事务的代码,通过标注或配置文件来声明事务特性获得容器提供的事务。有两种方式：
1，一般性的事务管理（只管理一个事务，事务结束后就关闭，一个事物范围内）
2，可扩展的事务管理（可以管理多个事务，但是只要一个事物出错，就可能导致与数据库的数据不同步，只能是有状态的bean使用，一般很少用）
[code=java]
@PersistenceContext
protected EntityManager em;
@TransactionAttribute(TransactionAttributeType.REQUIRED )
public void ModifyProductName(String newname, boolean error) throws Exception {
	Query query = em.createQuery("select p from Product p");
	List result = query.getResultList();
	if (result!=null){
		for(int i=0;i<result.size();i++){
			Product product = (Product)result.get(i);
			product.setName(newname+ i);
			em.merge(product);
		}
		if (error && result.size()>0) throw new TransException ("抛出应用例外");
	}
} 
[/code]
事务的传播行为
EJB的Bean对待客户端事务的行为共分为六种:
1.REQUIRED：方法在一个事务中执行，如果调用的方法已经在一个事务中，则使用该事务，否则将创建一个新的事务。
2.MANDATORY：如果运行于事务中的客户调用了该方法，方法在客户的事务中执行。如果客户没有关联到事务中，容器就会抛出TransactionRequiredException。如果企业bean 方法必须用客户事务则采用Mandatory 属性。
3.REQUIRESNEW:方法将在一个新的事务中执行，如果调用的方法已经在一个事务中，则暂停旧的事务。在调用结束后恢复旧的事务。
4.SUPPORTS:如果方法在一个事务中被调用，则使用该事务，否则不使用事务。
5.NOT_SUPPORTED：如果方法在一个事务中被调用，容器会在调用之前中止该事务。在调用结束后，容器会恢复客户事务。如果客户没有关联到一个事务中，容器不会在运行入该方法前启动一个新的事务。用NotSupported属性标识不需要事务的方法。因为事务会带来更高的性能支出，所以这个属性可以提高性能。
6.Never：如果在一个事务中调用该方法，容器会抛出RemoteException。如果客户没有关联到一个事务中，容器不会在运行入该方法前启动一个新的事务。
标注
[code=java]
@TransactionManagement
[/code]
用在类之前，用来告诉容器现在使用BMT/CMT
[code=java]
*TransactionManagementType.BEAN
*TransactionManagementType.CONTAINER(默认)
@TransactionAttribute
[/code]
用在方法之前，用来声明事务传播行为